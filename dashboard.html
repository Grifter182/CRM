<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MerchantHaus — OS‑style CRM</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
  <style>
    /* --- THEMES --- */
    /* Default Theme */
    :root {
      --brand-red: #ef3c5b;
      --brand-green: #6dffca;
      --ink: #f5f5f5;
      --muted: #b3b3b3;
      --bg-surface: rgba(255, 255, 255, .06);
      --border-color: rgba(255, 255, 255, .12);
      --shadow-color: rgba(0,0,0,.5);
      --main-bg: transparent;
      --header-bg: rgba(0,0,0,.35);
      --veil-gradient: radial-gradient(1200px 800px at 60% 35%, rgba(0,0,0,.25), rgba(0,0,0,.65)), linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.55));
    }
    /* Noir Theme */
    body[data-theme="noir"] {
      --brand-red: #770000;
      --brand-green: #770000;
      --ink: #dddddd;
      --muted: #9b9b9b;
      --bg-surface: rgba(89, 89, 89, 0.7);
      --border-color: rgba(155, 155, 155, 0.2);
      --shadow-color: rgba(0,0,0,.7);
      --main-bg: #000000;
      --header-bg: rgba(10, 10, 10, 0.5);
      --veil-gradient: rgba(0,0,0,0.4);
    }
    body[data-theme="noir"] .bg { background-image: none; }
    body[data-theme="noir"] .title { color: #dddddd; }
    body[data-theme="noir"] .app-icon {
      background-color: var(--main-bg);
    }
    body[data-theme="noir"] .cta {
      color: #fff;
      background: var(--brand-red);
      border: 1px solid rgba(255, 255, 255, 0.4);
    }


    /* Capra Theme (Light) */
    body[data-theme="capra"] {
      --brand-red: #D4AF37; /* Golden/Ochre */
      --brand-green: #228B22; /* Forest Green */
      --ink: #18181b;
      --muted: #52525b;
      --bg-surface: rgba(255,255,255,0.75);
      --border-color: rgba(0,0,0,0.1);
      --shadow-color: rgba(0,0,0,.15);
      --main-bg: #FDF5E6; /* Warm Beige/Cream */
      --header-bg: rgba(253, 245, 230, 0.5);
      --veil-gradient: rgba(0,0,0,0.1);
    }
    body[data-theme="capra"] .title { color: #800000; } /* Maroon */
    body[data-theme="capra"] .app-icon h2 { color: #6A5ACD; } /* Dusty Blue */
    body[data-theme="capra"] .bg { background-image: none; }
    
    /* Lunar Theme (Light) */
    body[data-theme="lunar"] {
      --brand-red: #484b6a;
      --brand-green: #484b6a;
      --ink: #484b6a;
      --muted: #9394a5;
      --bg-surface: rgba(210, 211, 219, 0.75);
      --border-color: rgba(72, 75, 106, 0.2);
      --shadow-color: rgba(72, 75, 106, 0.15);
      --main-bg: #e4e5f1;
      --header-bg: rgba(228, 229, 241, 0.5);
      --veil-gradient: rgba(255, 255, 255, 0.1);
    }
    body[data-theme="lunar"] .bg { background-image: none; }
    body[data-theme="lunar"] .title { color: #484b6a; }
    body[data-theme="lunar"] .cta { color: #fff; }
    
    /* Wednesday Theme */
    body[data-theme="wednesday"] {
      --brand-red: #016764; /* Caribbean Current */
      --brand-green: #005958; /* Deep Teal */
      --ink: #f0f0f0; /* Off-white for legibility */
      --muted: #a0a0a0; /* Muted gray for secondary text */
      --bg-surface: rgba(1, 72, 72, 0.7); /* Midnight Green glass */
      --border-color: rgba(1, 103, 100, 0.2);
      --shadow-color: rgba(0,0,0,.7);
      --main-bg: #001E1E; /* Rich Black */
      --header-bg: rgba(0, 30, 30, 0.5);
      --veil-gradient: rgba(0,0,0,0.4);
    }
    body[data-theme="wednesday"] .bg { background-image: none; }
    body[data-theme="wednesday"] .title { color: #f0f0f0; }
    body[data-theme="wednesday"] .cta { color: #fff; }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      background-color: var(--main-bg);
      transition: background-color 0.3s, color 0.3s;
    }

    .bg { position: fixed; inset: 0; z-index: -2; background-image: url("background.webp"); background-position: center; background-size: cover; }
    .veil { position: fixed; inset: 0; z-index: -1; background: var(--veil-gradient); transition: background 0.3s; }

    header { position: fixed; left: 0; right: 0; top: 0; height: 56px; display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; background: var(--header-bg); backdrop-filter: blur(6px); border-bottom: 1px solid var(--border-color); z-index: 50; transition: border-color 0.3s, background-color 0.3s; }
    .brand { display: flex; align-items: center; gap: 10px; }
    .logo { width: 24px; height: 24px; }
    .title {
      font-family: "Major Mono Display", monospace;
      letter-spacing: 1px;
      font-size: 18px;
      color: #FFFFFF;
      line-height: 1;
      transition: color 0.3s;
    }
    .btn { display: inline-flex; align-items: center; gap: 8px; border: 1px solid var(--border-color); background: var(--bg-surface); color: var(--ink); padding: 8px 10px; border-radius: 10px; cursor: pointer; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
    .btn:hover { background: rgba(255,255,255,.1); }
    .btn:active { transform: translateY(1px); }
    
    .theme-container {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #4a4a4a !important;
      border: 1px solid rgba(255,255,255,.2) !important;
      padding-left: 12px;
    }
    .theme-container label {
      color: #fff !important;
      font-size: 14px;
      pointer-events: none;
    }
    .theme-select {
      -webkit-appearance: none; -moz-appearance: none; appearance: none;
      background: transparent;
      border: none;
      outline: none;
      color: #fff !important;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1em;
      padding-right: 2rem;
    }
    .theme-select option {
      background: #2a2a2a;
      color: white;
    }

    main { position: relative; height: 100dvh; padding-top: 56px; overflow: hidden; }
    .dock { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; padding: 20px; }
    .app-icon { min-height: 120px; border-radius: 16px; background: var(--bg-surface); border: 1px solid var(--border-color); box-shadow: 0 8px 30px var(--shadow-color); padding: 14px 14px 16px; transition: transform 0.2s, box-shadow 0.3s, background-color 0.3s, border-color 0.3s; }
    .app-icon:hover { transform: translateY(-4px); box-shadow: 0 12px 40px var(--shadow-color); }
    .app-icon h2 { margin: 0 0 8px; font-size: 13px; letter-spacing: 1px; text-transform: uppercase; color: var(--brand-green); transition: color 0.3s; }
    .app-icon p { margin: 0 0 10px; color: var(--muted); font-size: 13px; line-height: 1.35; transition: color 0.3s; }
    .cta { display: inline-block; margin-top: 12px; padding: 8px 12px; border-radius: 10px; border: none; background: var(--brand-red); color: #111; font-weight: 700; cursor: pointer; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
    .cta:active { transform: translateY(1px); }

    .window {
        display: none; position: absolute; width: 800px; max-width: 90vw; min-height: 300px;
        border-radius: 16px; background: var(--bg-surface); border: 1px solid var(--border-color);
        box-shadow: 0 12px 50px rgba(0,0,0,.6); backdrop-filter: blur(12px);
        user-select: none; resize: both; overflow: hidden;
        transition: background-color 0.3s, border-color 0.3s;
    }
    .window-header { height: 40px; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; background: rgba(255,255,255,.05); cursor: grab; }
    .window-header:active { cursor: grabbing; }
    .window-title { font-weight: 600; font-size: 14px; }
    .window-controls { display: flex; gap: 6px; }
    .window-btn { width: 14px; height: 14px; border-radius: 50%; border: none; cursor: pointer; }
    .close-btn { background-color: #ff5f56; }
    .window-content { padding: 20px; height: calc(100% - 40px); overflow-y: auto; }

    .content-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .content-table th, .content-table td { padding: 10px 12px; text-align: left; border-bottom: 1px solid var(--border-color); transition: border-color 0.3s; }
    .content-table thead th { color: var(--muted); text-transform: uppercase; font-size: 11px; letter-spacing: 0.5px; transition: color 0.3s; }
    .status-pill { display: inline-block; padding: 4px 8px; border-radius: 99px; font-size: 11px; font-weight: 500; }
    .status-active { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .status-due { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .status-failed { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
    .form-group label { font-size: 13px; color: var(--muted); margin-bottom: 6px; display: block; transition: color 0.3s; }
    .form-input { background-color: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 12px; font-size: 14px; color: var(--ink); width: 100%; box-sizing: border-box; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; }
    .stat-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; transition: background-color 0.3s, border-color 0.3s; }
    .stat-label { font-size: 13px; color: var(--muted); transition: color 0.3s; }
    .stat-value { font-size: 24px; font-weight: 600; margin-top: 4px; }
    
    .toast { position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%) translateY(100%); opacity: 0; background: rgba(0,0,0,.6); backdrop-filter: blur(6px); border: 1px solid var(--border-color); padding: 8px 12px; border-radius: 10px; color: #fff; transition: all .3s cubic-bezier(0.215, 0.610, 0.355, 1); z-index: 1000; }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .radial { position: fixed; inset: 0; display: none; z-index: 70; }
    .radial.open { display: block; }
    .radial .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.25); }
    .radial .node { position: absolute; transform: translate(-50%,-50%); }
    .bubble { border: 1px solid var(--border-color); background: var(--bg-surface); backdrop-filter: blur(4px); padding: 9px 12px; border-radius: 12px; color: var(--ink); font-size: 12px; white-space: nowrap; cursor: pointer; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="veil"></div>

  <header>
    <div class="brand">
      <img src="CRMlogo.png" alt="Haus Manager Logo" class="logo">
      <div class="title">Haus Manager</div>
    </div>
    <div style="display:flex; gap:8px; align-items:center">
      <div class="btn theme-container">
        <label for="theme-selector">Theme</label>
        <select id="theme-selector" class="theme-select">
          <option value="default">Default</option>
          <option value="capra">Capra</option>
          <option value="noir">Noir</option>
          <option value="lunar">Lunar</option>
          <option value="wednesday">Wednesday</option>
        </select>
      </div>
      <button id="toggleMute" class="btn" title="Mute/Unmute">🔊 Sound On</button>
      <button id="openSearch" class="btn" title="Search (⌘/Ctrl+K)">Search</button>
    </div>
  </header>

  <main id="desktop">
    <div class="dock">
      <section class="app-icon">
        <h2>Recurring</h2>
        <p>Manage recurring payment plans and schedules.</p>
        <button class="cta" data-action="open:recurring">Open</button>
      </section>
      <section class="app-icon">
        <h2>Customer Vault</h2>
        <p>Securely store and manage customer payment information.</p>
        <button class="cta" data-action="open:vault">Open</button>
      </section>
       <section class="app-icon">
        <h2>Invoices</h2>
        <p>Create, send, and track customer invoices.</p>
        <button class="cta" data-action="open:invoices">Open</button>
      </section>
       <section class="app-icon">
        <h2>Marketplace Apps</h2>
        <p>Browse and integrate third-party applications.</p>
        <button class="cta" data-action="open:marketplace">Open</button>
      </section>
       <section class="app-icon">
        <h2>Collect Checkout</h2>
        <p>Configure and manage your hosted checkout pages.</p>
        <button class="cta" data-action="open:checkout">Open</button>
      </section>
       <section class="app-icon">
        <h2>Product Manager</h2>
        <p>Create and manage your product catalog.</p>
        <button class="cta" data-action="open:products">Open</button>
      </section>
       <section class="app-icon">
        <h2>Other Services</h2>
        <p>Access additional services and features.</p>
        <button class="cta" data-action="open:services">Open</button>
      </section>
      <section class="app-icon">
        <h2>Transaction Reports</h2>
        <p>View detailed reports on your transactions.</p>
        <button class="cta" data-action="open:reports">Open</button>
      </section>
       <section class="app-icon">
        <h2>Options</h2>
        <p>Configure your account and application settings.</p>
        <button class="cta" data-action="open:options">Open</button>
      </section>
       <section class="app-icon">
        <h2>Help</h2>
        <p>Access documentation and support resources.</p>
        <button class="cta" data-action="open:help">Open</button>
      </section>
    </div>

    <!-- Placeholder Windows for New Modules -->
    <div id="window-recurring" class="window"><div class="window-header"><span class="window-title">Recurring</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:recurring"></button></div></div><div class="window-content"><p>Recurring content goes here.</p></div></div>
    <div id="window-vault" class="window"><div class="window-header"><span class="window-title">Customer Vault</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:vault"></button></div></div><div class="window-content"><p>Customer Vault content goes here.</p></div></div>
    <div id="window-invoices" class="window"><div class="window-header"><span class="window-title">Invoices</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:invoices"></button></div></div><div class="window-content"><p>Invoices content goes here.</p></div></div>
    <div id="window-marketplace" class="window"><div class="window-header"><span class="window-title">Marketplace Apps</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:marketplace"></button></div></div><div class="window-content"><p>Marketplace Apps content goes here.</p></div></div>
    <div id="window-checkout" class="window"><div class="window-header"><span class="window-title">Collect Checkout</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:checkout"></button></div></div><div class="window-content"><p>Collect Checkout content goes here.</p></div></div>
    <div id="window-products" class="window"><div class="window-header"><span class="window-title">Product Manager</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:products"></button></div></div><div class="window-content"><p>Product Manager content goes here.</p></div></div>
    <div id="window-services" class="window"><div class="window-header"><span class="window-title">Other Services</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:services"></button></div></div><div class="window-content"><p>Other Services content goes here.</p></div></div>
    <div id="window-options" class="window"><div class="window-header"><span class="window-title">Options</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:options"></button></div></div><div class="window-content"><p>Options content goes here.</p></div></div>
    <div id="window-help" class="window"><div class="window-header"><span class="window-title">Help</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:help"></button></div></div><div class="window-content"><p>Help content goes here.</p></div></div>
    
    <!-- Existing Windows -->
    <div id="window-reports" class="window">
      <div class="window-header"><span class="window-title">Transaction Reports</span><div class="window-controls"><button class="window-btn close-btn" data-action="close:reports"></button></div></div>
      <div class="window-content">
        <h3 style="margin-top:0;">Overview</h3>
        <div class="stat-grid">
            <div class="stat-card"><div class="stat-label">Gross Revenue</div><div class="stat-value">$152,310</div></div>
            <div class="stat-card"><div class="stat-label">Net Revenue</div><div class="stat-value">$138,940</div></div>
            <div class="stat-card"><div class="stat-label">AOV</div><div class="stat-value">$317</div></div>
            <div class="stat-card"><div class="stat-label">Refund Rate</div><div class="stat-value">0.8%</div></div>
        </div>
      </div>
    </div>
  </main>
  
  <div id="radial" class="radial" aria-hidden="true"></div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ---- Audio ----
    let audioReady = false, muted = false, startSoundPlayed = false;
    let clickSfx = null, popSfx = null, startSfx = null, rightClickSfx = null;
    const muteButton = document.getElementById('toggleMute');

    function prepareAudio() {
      try {
        clickSfx = new Audio('click.mp3');
        popSfx = new Audio('pop.mp3');
        startSfx = new Audio('start.mp3');
        rightClickSfx = new Audio('rightclick.mp4');
        [clickSfx, popSfx, startSfx, rightClickSfx].forEach(a => {
            a.preload = 'auto'; a.volume = muted ? 0 : 1;
        });
        audioReady = true;
      } catch (e) {
        console.error("Could not initialize audio files. Ensure they are in the root directory.", e);
      }
    }
    
    function playStartupSoundOnce() {
        if (!audioReady || startSoundPlayed) return;
        playSfx(startSfx);
        startSoundPlayed = true;
    }

    function playSfx(sfx) { 
      if (audioReady && !muted && sfx) { 
        try { sfx.currentTime = 0; sfx.play().catch(e => {}); } catch (e) {} 
      } 
    }

    // ---- Toast ----
    const toast = document.getElementById('toast');
    let toastTimeout;
    function notify(msg) {
      clearTimeout(toastTimeout);
      toast.textContent = msg;
      toast.classList.add('show');
      toastTimeout = setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ---- Window Management ----
    let openWindows = 0;
    function getNextWindowPosition() {
        const cascadeOffset = 40;
        const initialX = window.innerWidth > 800 ? 50 : 20;
        const initialY = 80;
        const top = initialY + (openWindows % 5) * cascadeOffset;
        const left = initialX + (openWindows % 5) * cascadeOffset;
        openWindows++;
        return { top, left };
    }

    function bringToFront(el) {
        const windows = document.querySelectorAll('.window');
        const maxZ = Math.max(10, ...Array.from(windows).map(w => parseInt(w.style.zIndex || '10')));
        el.style.zIndex = maxZ + 1;
    }

    document.querySelectorAll('.window').forEach(win => {
        const header = win.querySelector('.window-header');
        let sx, sy, ox, oy, drag = false;
        
        const startDrag = (e) => {
            if (e.target.closest('.window-btn')) return;
            playSfx(clickSfx);
            drag = true;
            const event = e.touches ? e.touches[0] : e;
            sx = event.clientX; sy = event.clientY;
            ox = win.offsetLeft; oy = win.offsetTop;
            bringToFront(win);
        };
        const dragWindow = (e) => {
            if (!drag) return;
            e.preventDefault();
            const event = e.touches ? e.touches[0] : e;
            let newX = ox + event.clientX - sx;
            let newY = oy + event.clientY - sy;
            
            const headerHeight = 56;
            const taskbarHeight = 40;
            newX = Math.max(0, Math.min(newX, window.innerWidth - win.offsetWidth));
            newY = Math.max(headerHeight, Math.min(newY, window.innerHeight - win.offsetHeight - taskbarHeight));

            win.style.left = `${newX}px`;
            win.style.top = `${newY}px`;
        };
        const stopDrag = () => { drag = false; };

        header.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', dragWindow);
        document.addEventListener('mouseup', stopDrag);
        header.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', dragWindow, { passive: false });
        document.addEventListener('touchend', stopDrag);
        win.addEventListener('mousedown', () => bringToFront(win));
    });

    document.addEventListener('click', e => {
        const target = e.target.closest('[data-action]');
        if (!target) return;
        
        const [type, id] = target.getAttribute('data-action').split(':');

        if (type === 'open') {
            playSfx(popSfx);
            const win = document.getElementById(`window-${id}`);
            if (win) {
                if(win.style.display !== 'block') {
                    const {top, left} = getNextWindowPosition();
                    win.style.top = `${top}px`;
                    win.style.left = `${left}px`;
                }
                win.style.display = 'block'; 
                bringToFront(win); 
            }
        } else if (type === 'close') {
            playSfx(clickSfx);
            const win = document.getElementById(`window-${id}`);
            if (win) win.style.display = 'none';
        }
    });
    
    // ---- Right-click Radial Menu ----
    const radial = document.getElementById('radial');
    const themeSelector = document.getElementById('theme-selector');
    const themes = Array.from(themeSelector.options).map(opt => opt.value);

    function cycleTheme() {
        const currentTheme = document.body.dataset.theme || 'default';
        const currentIndex = themes.indexOf(currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        applyTheme(themes[nextIndex]);
        notify(`Theme changed to ${themes[nextIndex]}`);
    }
    
    const radialActions = [
      {label:'New Report', fn:()=>notify('Opening new report...')},
      {label:'Add Subscription', fn:()=>notify('Opening new subscription form...')},
      {label:'Global Search', fn:()=>notify('Opening search...')},
      {label:'Cycle Theme', fn: cycleTheme},
    ];

    function openRadial(x,y){
      radial.innerHTML='<div class="backdrop"></div>'; 
      const R=100; 
      radialActions.forEach((a,i)=>{ 
        const ang=(i/radialActions.length)*Math.PI*2 - Math.PI/2; 
        const nx=x+Math.cos(ang)*R; const ny=y+Math.sin(ang)*R; 
        const b=document.createElement('button'); 
        b.className='node bubble'; b.style.left=nx+'px'; b.style.top=ny+'px'; b.textContent=a.label; 
        b.addEventListener('click',()=>{ a.fn(); playSfx(popSfx); closeRadial(); }); 
        radial.appendChild(b); 
      }); 
      radial.classList.add('open'); 
    }
    function closeRadial(){ radial.classList.remove('open'); }
    
    window.addEventListener('contextmenu', e => { 
        e.preventDefault(); 
        playSfx(rightClickSfx); 
        openRadial(e.clientX, e.clientY); 
    });
    radial.addEventListener('click', e => { 
        if(e.target.classList.contains('backdrop')) { playSfx(clickSfx); closeRadial(); }
    });

    // ---- Header Controls & Theme Management ----
    function applyTheme(theme) {
        document.body.dataset.theme = theme;
        localStorage.setItem('crm-theme', theme);
        if (themeSelector.value !== theme) themeSelector.value = theme;
    }
    themeSelector.addEventListener('change', (e) => applyTheme(e.target.value));
    
    document.getElementById('openSearch').addEventListener('click', () => { playSfx(clickSfx); notify('Search coming soon…'); });
    muteButton.addEventListener('click', () => {
      muted = !muted;
      [clickSfx, popSfx, startSfx, rightClickSfx].forEach(a => { if (a) a.volume = muted ? 0 : 1; });
      muteButton.textContent = muted ? '🔇 Sound Off' : '🔊 Sound On';
      if (!muted) playSfx(clickSfx);
      notify(muted ? 'Sound off' : 'Sound on');
    });

    // ---- Initial Load ----
    const savedTheme = localStorage.getItem('crm-theme') || 'default';
    applyTheme(savedTheme);
    document.addEventListener('DOMContentLoaded', prepareAudio);
    ['click', 'keydown', 'touchstart'].forEach(ev => window.addEventListener(ev, playStartupSoundOnce, { once: true }));
  </script>
</body>
</html>
